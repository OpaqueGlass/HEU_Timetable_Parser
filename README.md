# HEU_Timetable_Parser_in_Xiaoai
Last Update :2022.02.16 11:00

> **说明** 由于访问GitHub变得愈加困难，在GitHub的更新可能会暂时中断，你可以访问[Gitee仓库副本](https://gitee.com/opaqueglass/HEU_Timetable_Parser)获取WiKi更新。
> 
> **临期说明** 项目已经基本完成了强智3教务的课表导入适配工作。未来不再变动抓取和解析html的部分。
>
>谢谢关注。

## 更新日志

> 我觉得这么重大的更新应该可以算是**第五版**了吧。

2022-2-16 **v0.4.6**课表分析器分析html获取课程信息本身并没有变化，新增冲突课程处理（beta）。

> 新版本0.4.0（第四版）的更改受Holit:HEU_edusys_miui项目的启发，本项目（理论课表分析器v0.4.x）只是对大佬思路的拙劣模仿。
> 具体地，从第四版（0.4.0）起，换用jQuery(cheerio) children获取课程信息的方式，不再使用获取全部文本再拆分的方式获取课程名、教师名、上课地点和上课时间等信息。参考了大佬的jQuery获取思路和课表部分信息为空的错误处理方式。

2021-10-23 \[适配\]工程实践课表；\[适配\]由于2021秋季学期工程实践课程顺延导致的课程错位1周的问题；{理论课表分析器（v0.4.2b）工程实践课表分析器（v0.1.1）合并版本（v0.1.6）}

2021-09-10 换用jQuery(cheerio) children获取课程信息的方式，修复单双周识别错误的问题（0.4.1，此版本未上传，0.4.2保留了该修复），修复课程数大于5时导入崩溃的问题（0.4.2）。（第四版）

2021-08-27 修复了issue5（#5）对应的问题，此版本可以勉强完成导入工作。（第三版）

2020-11-23 修复了issue3对应的问题，现在导入无课程地点的项目不会再卡死了。（第二版）

2020-10-04 上传第一代版本，同步在小米审核。

2020-10-03 在本地编辑、调试代码。（此部分代码没有上传）

## 概述

此脚本作为*小爱同学课程表*适配教务系统的一部分，用于*小爱课程表*截取哈尔滨工程大学教务系统数据后的拆分、转换工作，产生的数据用于小爱课程表导入课表数据。

### 理论课表分析

`scheduleHtmlParser.js` 当前最新版本v0.4.6

上传的代码只是一个（组）用于解析课表的函数，此脚本不能直接运行，至少需要配置cheerio才能运行。如果需要，请待审核通过后于**小爱课程表导入课表**。

因为本人的技术不高、完全是小白，这里展示的代码有较多的冗余，但也希望这能作为适配其他学校教务系统的参考。

**Holit/HEU_edusys_miui**项目: HEU本科生教务系统在小爱的导入**比本项目更加稳定**，请前往
https://github.com/Holit/HEU_edusys_miui
了解。

### 工程实践课表分析（合并版本）

`Parse_withPracticeLesson.js` 当前最新版本v0.2.3

原本在做的时候，工程实践课表分析是单独工作的（会把工程实践课表单独导出），这个版本只是将两个分析器进行了强制合并。

由于参数限制了只能有一个html文件传入，Provider将两个页面html文件内容进行了合并（就是硬拼到一起），目前看来没啥问题的样子。

## TODO

- [x] 增加各行意义注释（对于新增的部分代码，我完善了代码含义的注释说明，使用doc格式对函数的作用进行了注释）；
- [ ] 优化课程数确定方法；
- [x] 稳定适配工程实践课表（2021）；
- [x] 弃用location数组定位教师名、上课教室的方案；(0.4.0)
- [x] 不使用非数字判断课程名，而是直接获取；(0.4.0)
- [x] 不使用id寻找、判定数据。(已处理 #1)。

## 导入说明

0. 审核和内测期间你可能无法导入课表；
1. iOS下载小爱课程表，非小米手机需要下载小爱课程表（app），小米手机叫出小爱同学，说“打开课程表”;
2. 请在右下角->设置->选择学校为“哈尔滨工程大学-强智教务学期理论课表”，然后点击“教务网站导入-\[导入\]”;
3. 在校园网环境下输入账号、密码，点击“课表查询”，点击右下角“一键导入”；
4. 如果未能打开教务系统，显示“正在跳转统一身份验证平台”或英文，请退出（按下返回键），然后重新导入；
5. 如果仍然不能导入，请在issue中提供反馈，建议你的反馈包括问题发生截图（或截图链接）、课表页HTML文件。

## 参考资料&感谢
> 以下资料对这个脚本的诞生至关重要，在此表示感谢

SZTU深圳技术大学教务系统小爱课程表导入——强智科技13369 （作者：源心锁  ）

https://blog.csdn.net/qq_38331169/article/details/108500577?utm_source=app

官方说明文档

https://ldtu0m3md0.feishu.cn/docs/doccnhZPl8KnswEthRXUz8ivnhb#line-41

cheerio说明文档（官方）
https://cheerio.js.org/

cheerio说明文档（中文翻译）
https://www.jianshu.com/p/629a81b4e013

> 向大佬致敬（更简洁优美的HEU课程表适配实现）

Holit: HEU本科生教务系统在小爱的导入

https://www.cnblogs.com/holittech/p/miui_schedule_document.html

https://github.com/Holit/HEU_edusys_miui
